@model WEB_353503_Sebelev.UI.ViewModels.BookListViewModel

<html>
<body>
<div class="row mt-4">
    <div class="col-md-2">
        <ul class="nav">
            <li class="nav-item dropdown">
                <a href="#" 
                   class="nav-item dropdown-toggle"
                   data-bs-toggle="dropdown"
                   role="button"
                   aria-expanded="false">@(ViewData["currentCategory"] ?? "Все категории")
                </a>
                <ul class="dropdown-menu">
                    <li>
                        <a class="dropdown-item"
                           asp-controller="Book"
                           asp-route-category=@null>Все катерогии</a>
                    </li>
                    @foreach (var item in Model.Categories)
                    {
                        <li>
                            <a class="dropdown-item"
                               asp-controller="Book"
                               asp-route-category="@item.NormalizedName">
                                @item.Name
                            </a>
                        </li>
                    }
                </ul>
            </li>
        </ul>
    </div>
    
    <div class="col-md-10" id="bookListContainer">
        @await Html.PartialAsync("_BookListPartial", Model)
    </div>
</div> 
</body>
</html>

@section Scripts
{
    <script>
        $(document).ready(function () {
            // Загрузка при клике на пейджер
            $(document).on('click', '.page-link', function (e) {
                e.preventDefault();

                var href = $(this).attr('href');

                // Если это ссылка "отключена", не делаем запрос
                if ($(this).closest('li').hasClass('disabled')) {
                    return;
                }

                // Ajax запрос
                $.ajax({
                    url: href,
                    headers: {
                        'x-requested-with': 'XMLHttpRequest'
                    },
                    success: function (result) {
                        $('#bookListContainer').html(result);
                    },
                    error: function () {
                        alert('Error loading books');
                    }
                });
            });

            // Загрузка при смене категории
            $(document).on('click', '.dropdown-item', function (e) {
                var href = $(this).attr('href');
                
                if (href === '#') {
                    e.preventDefault();
                    return;
                }

                e.preventDefault();

                $.ajax({
                    url: href,
                    headers: {
                        'x-requested-with': 'XMLHttpRequest'
                    },
                    success: function (result) {
                        $('#bookListContainer').html(result);
                    },
                    error: function () {
                        alert('Error loading books');
                    }
                });
            });
        });
    </script>
}
