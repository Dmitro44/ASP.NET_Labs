@inject IDataService DataService

<div class="category-selector">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Категория</h5>
            
            <!-- Bootstrap Dropdown -->
            @if (DataService.Categories is not null && DataService.Categories.Count > 0)
            {
                <div class="dropdown">
                    <button 
                        class="btn btn-primary dropdown-toggle" 
                        type="button" 
                        id="categoryDropdown" 
                        data-bs-toggle="dropdown" 
                        aria-expanded="false">
                        @if (DataService.SelectedCategory != null)
                        {
                            <span>@DataService.SelectedCategory.Name</span>
                        }
                        else
                        {
                            <span>Все категории</span>
                        }
                    </button>
                    
                    <ul class="dropdown-menu" aria-labelledby="categoryDropdown">
                        <li>
                            <a class="dropdown-item-text @(DataService.SelectedCategory == null ? "active" : "")" 
                               @onclick="@((e) => HandleSelectCategory(null, e))">
                                Все категории
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        
                        @foreach (var category in DataService.Categories)
                        {
                            <li>
                                <a 
                                    class="dropdown-item @(DataService.SelectedCategory?. Id == category.Id ? "active" : "")" 
                                    @onclick="@((e) => HandleSelectCategory(category, e))">
                                    @category.Name
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            }
            else
            {
                <p class="text-muted">Загрузка категорий...</p>
            }
        </div>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await DataService.GetCategoryListAsync();
    }

    private async Task HandleSelectCategory(Category? selectedCategory, MouseEventArgs e)
    {
        DataService.SelectedCategory = selectedCategory;

        await DataService.GetBookListAsync(pageNo: 1);
    }
}